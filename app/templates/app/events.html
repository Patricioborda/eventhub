{% extends "base.html" %}

{% block title %}Eventos{% endblock %}

{% block content %}
<div class="containerEventos">
    <div class="encabezadoEventos mb-4">
        <h1>Eventos</h1>

        <div class="btn-group botonesEventos">
            <a href="/events/create/" class="btn btn-eventgub-green">
            <i class="bi bi-plus-circle me-2"></i>Crear Evento
            </a>
            <a href="/events/comments/" class="btn btn-outline-secondary">
            <i class="bi bi-chat-dots me-1"></i>Ver comentarios
            </a>
        </div>
    </div>
    
    <div class="table-wrapper-events">
  <div class="draggable-scroll" id="eventTableScroll">
    <table class="table table-hover table-events">
        <thead class="table-light">
            <tr>
                <th>Título</th>
                <th>Fecha</th>
                <th>Ubicación</th>
                <th>Organizador</th>
                <th>Categorías</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for event in events %}
                <tr>
                    <td>{{ event.title }}</td>
                    <td>{{ event.scheduled_at|date:"d M Y, H:i" }}</td>
                    <td>
                        {% if event.venue %}
                            {{ event.venue.name }}
                        {% else %}
                            Sin ubicación
                        {% endif %}
                    </td>
                    <td>{{ event.organizer.username }}</td>
                    <td>
                        {% if event.categories.exists %}
                            <div class="d-flex flex-wrap">
                                {% for category in event.categories.all %}
                                    <span class="badge bg-light text-dark mb-1 me-2">{{ category.name }}</span>
                                {% endfor %}
                            </div>
                        {% else %}
                            <span class="text-muted">Sin categorías</span>
                        {% endif %}
                    </td>
                    <td>
                        <div class="hstack gap-1">
                            <button class="btn btn-sm btn-fav-toggle" title="Marcar como favorito" data-event-id="{{ event.id }}">
                              {% if event.id in favoritos_ids %}
                                <i class="bi bi-star-fill text-warning fav-glow"></i>
                              {% else %}
                                <i class="bi bi-star"></i>
                              {% endif %}
                            </button>
                            <a href="{% url 'event_detail' event.id %}" class="btn btn-sm btn-outline-primary" title="Ver detalle">
                              <i class="bi bi-eye"></i>
                            </a>
                            {% if user_is_organizer %}
                              <a href="{% url 'event_edit' event.id %}" class="btn btn-sm btn-outline-secondary" title="Editar">
                                <i class="bi bi-pencil"></i>
                              </a>
                              <form action="{% url 'event_delete' event.id %}" method="POST" style="display: inline;">
                                {% csrf_token %}
                                <button class="btn btn-sm btn-outline-danger" title="Eliminar" type="submit">
                                  <i class="bi bi-trash"></i>
                                </button>
                              </form>
                            {% endif %}
                        </div>
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="6" class="text-center">No hay eventos disponibles</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
  </div>
</div>
{% endblock %}